version: "3.8"

services:
  # -----------------------------------------------------
  # MCP SERVER (your Express + StreamableHTTP MCP server)
  # -----------------------------------------------------
  mcp-server:
    container_name: sentice-mcp
    build:
      context: .
    environment:
      - PORT=3000
      - BACKEND_URL=${BACKEND_URL}
    ports:
      - "3000:3000"
    restart: always
    networks:
      - food2
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s

  # -----------------------------------------------------
  # MCP INSPECTOR (UI + PROXY)
  # -----------------------------------------------------
  mcp-inspector:
    image: node:20
    container_name: mcp-inspector
    working_dir: /workspace
    command: >
      sh -c "
      npm install -g @modelcontextprotocol/inspector &&
      mcp-inspector http://sentice-mcp:3000/mcp --transport streamable-http
      "
    depends_on:
      mcp-server:
        condition: service_healthy
    ports:
      - "6274:6274"
      - "6277:6277"
    environment:
      - HOST=0.0.0.0
      - SERVER_HOST=0.0.0.0
      - CLIENT_HOST=0.0.0.0
    restart: always
    networks:
      - food2

# -----------------------------------------------------
# EXTERNAL NETWORK
# -----------------------------------------------------
networks:
  food2:
    external: true
